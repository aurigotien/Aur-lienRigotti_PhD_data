### Biaxial compression of granular media ###
    
## Modification of the simulation ##
   
    change_box   all triclinic &
                 boundary p p p units box # change the bondary condtions to compression the sample with a barostat
    set          group all image NULL NULL NULL  # remap the grains with the new bondary limit
        
## Computation ## 

    # Stress of the system 
    compute      sigma_comp all stress/atom NULL virial # computation of the stress tensor componenent for each atoms
    compute      moy_sigma_comp all reduce sum c_sigma_comp[*] # sum the stress tensor over every atoms
    
    variable     p_comp equal "(c_moy_sigma_comp[1] + c_moy_sigma_comp[2])/2"
    variable     sigma_comp_xx equal c_moy_sigma_comp[1]
    variable     sigma_comp_yy equal c_moy_sigma_comp[2]
    variable     sigma_comp_xy equal c_moy_sigma_comp[4]
    
    # Neighbor computation
    compute      voisin all contact/atom # compute number of neighbor  at d = dmin of the center of each grains
    compute      moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains
    
    # Grains movement
    compute      u_comp all displace/atom
    compute      u_moy_comp all reduce ave c_u_comp[*][*]
    
    # Temperature 
    compute      temperature all temp/sphere
    
## Output commmand ##
    
    thermo       5000 # output every 5000 time step
    thermo_style custom step atoms c_temperature c_moy_voisin &
                 density press c_u_moy_comp[1] c_u_moy_comp[2] &
                 lx ly &
                 v_sigma_comp_xx  v_sigma_comp_yy v_sigma_comp_xy &
                 v_p_comp
                 
    #dump		 compression_img all image 100000 compression.*.jpg type type &
    #             zoom 1.6 adiam 4.0
    #dump_modify	 compression_img pad 5
    
	#dump         compression all movie 500 compression.avi type type &
    #             zoom 1.6 adiam 4.0 # create a video of the compression step
	#dump_modify  compression pad 5
    
## Fix for biaxial compression ##
    
    # DÃ©but de simulation
    timestep     1E-5 # simulation time step
    
    fix          comp all nph/sphere &
                 iso 8E3 8E3 1E3 disc 
                 # nreset 100000 # biaxial compression of the sample via a barostat p = 8.0 kPa
    
    fix          2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction

## End of compression ##

	run	         500000 #  500 000 step of simulation 
    
### End of compression step ###