### Relaxation of granular media ###

		neigh_modify 		every 1 delay 100 # Update frequency of the particle list every 1 step of time
	
	## Computation ## 
 
		# Neighbor computation
    		compute 		voisin all contact/atom 
    		compute		moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains
    
    		# Stress of the system
    		compute      		sigma_relax all stress/atom NULL virial  # computation of the stress tensor componenent for each atoms
    		compute      		moy_sigma_relax all reduce sum c_sigma_relax[*] # sum the stress tensor over every atoms
  	
	## Variable ## 
		
		variable 		RELAX_LEN equal 5000 # 5000 s relaxation
		variable 		DT equal 1E-3 # discretization time 
    		variable    		STEP_RELAX equal "v_RELAX_LEN / v_DT" # number of step of simulations
    		
    		variable 		THERMO_RELAX equal "v_STEP_RELAX / 100"
    		variable 		THERMO_DUMP equal "v_STEP_RELAX / 100" 
		
		#variable_S_GRAINS#
	    	variable 		LX equal lx
	    	variable 		LY equal ly
	    	variable 		PHI equal "v_S_GRAINS / (v_LX*v_LY)"
    		variable    		S_XX equal c_moy_sigma_relax[1]
    		variable    		S_YY equal c_moy_sigma_relax[2]
    		variable    		S_XY equal c_moy_sigma_relax[4]
    		variable    		P equal "(c_moy_sigma_relax[1]+c_moy_sigma_relax[2])/2"

	## Relaxation of the sample ##
		
    		# Beginning of the simulation
    		timestep    		${DT} # simulation time step
    		
		fix          		calcul_v_m all nve/sphere disc #  compute the velocity of the atoms and the angular momentum for every sphere    
		fix         		2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction

	## Output command ##

    		reset_timestep 	0
    		thermo       		${THERMO_RELAX} # output every THERMO_RELAX step of time
    		
    		# (0) number of the step ; (1) number of atoms ; (2) mean coordination number ; (3) packing fraction ; (4) horizontal simulation box length 
    		# (5) vertical simulation box length ; (6) stress S_xx ; (7) stress S_yy ; (8) stress S_xy ; (9) mean stress P
    		thermo_style 		custom &
    					step atoms c_moy_voisin v_PHI lx &
    	 	            		ly v_S_XX v_S_YY v_S_XY v_P &
    		
    		# Graphic output
    		dump 			relax_mm all custom ${THERMO_DUMP} preparation_2.txt &
					id x y diameter vx vy fx fy c_voisin
    
	## End of relaxation ##

     		run         		${STEP_RELAX} # step of simulation
     
### End of relaxation step ###       
   
