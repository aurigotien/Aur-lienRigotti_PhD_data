### Biaxial compression of granular media ###
   
   	## Computation ## 

		# Neighbor computation
   	 	compute      	voisin all coord/atom cutoff ${DMAX} # compute number of neighbor  at d = dmin of the center of each grains
   	 	compute      	moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains

   	 	# Stress of the system 
   	 	compute     	sigma_comp all stress/atom NULL virial # computation of the stress tensor componenent for each atoms
   	 	compute      	moy_sigma_comp all reduce sum c_sigma_comp[*] # sum the stress tensor over every atoms
    
	## Variable ##
	    	
	    	# Simulation parameters 
	    	variable     	COMP equal -1E-2 # compression strain rate
	    	variable     	STEP_COMP equal 440000 # number of step of simulation
	    	variable 	DT equal 1E-4 # discretization time 
	    	
	    	# Packing fraction monitoring
	    	#variable_S_GRAINS#
	    	variable 	LX equal lx
	    	variable 	LY equal ly
	    	variable 	PHI equal "v_S_GRAINS / (v_LX*v_LY)" # compute the packing fraction 
	    	
	    	# Stress monitoring 
	    	variable     	S_XX equal c_moy_sigma_comp[1] # normal stress S_xx
	    	variable     	S_YY equal c_moy_sigma_comp[2] # normal stress S_yy
	    	variable     	S_XY equal c_moy_sigma_comp[4] # shear stress S_xy
	    	variable     	P equal "(c_moy_sigma_comp[1] + c_moy_sigma_comp[2])/2" # mean stress P
		
	# Beginning of the simulation
	
   		timestep     	${DT} # simulation time step = DT
      
	## Fix for biaxial compression ##
		
		# Strain controled biaxial compression test
		fix          	comp all deform 100 &
				x erate ${COMP} &
				y erate ${COMP} &
				units box remap v  
		
		fix          	calcul_v_m all nve/sphere disc #  compute the velocity of the atoms and the angular momentum for every sphere   
	     	fix          	2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction

	## Output commmand ##
    
    		thermo      	10000 # output every 10 000 time step
    		
    		# (0) number of the step ; (1) number of atoms ; (2) mean coordination number ; (3) packing fraction ; (4) horizontal simulation box length 
    		# (5) vertical simulation box length ; (6) stress S_xx ; (7) stress S_yy ; (8) stress S_xy ; (9) mean stress P
    		thermo_style 	custom &
    				step atoms c_moy_voisin v_PHI lx &
    				ly v_S_XX v_S_YY v_S_XY v_P
                                          
		dump	    	compression_img all image 50000 compression.*.jpg type type zoom 1.6
    		dump_modify	compression_img pad 5 adiam 1 ${DMIN} adiam 2 ${DMAX}
   
		#dump         	compression all movie 500 compression.avi type type &
    		#		zoom 1.6 adiam 1.5 # create a video of the compression step
		#dump_modify  	compression pad 5

	## End of compression ##

    		run          	${STEP_COMP} 
    		print 		"--------------------------- PHI = ${PHI} ----------------------------"
                      
### End of compression step ###
