### Restart simulation ###
	## Elastique biaxial compression of granular media ###

	## Beginning of simulation ##
		timestep     	1E-4 # simulation time step

	## Stress controle variable ##
   	## Computation ##
   	
   		# Variable 
   		variable 	CUTOFF equal 1.4

    		# Neighbor computation
    		compute      	voisin all coord/atom cutoff ${CUTOFF} # compute number of neighbor  at d = dmin of the center of each grains
    		compute      	moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains
    
    		# Stress of the system 
    		compute      	sigma_comp all stress/atom NULL virial # computation of the stress tensor componenent for each atoms
    		compute      	moy_sigma_comp all reduce sum c_sigma_comp[*] # sum the stress tensor over every atoms
    
    		# Grains movement
    		compute      	u_comp all displace/atom
    		compute      	u_moy_comp all reduce ave c_u_comp[*][*]
    
    		# Temperature
    		compute      	temp_ela_comp all temp/sphere
    
	## Compute variable ##

    		# Strain deformation variables 
    		variable     	A_COMP equal 3E-5 # intermediate variable to applied the right stress on the sample 
    		variable     	TP_COMP equal 0.1
    		# Follow the stress state of the system
    		#variable_VISC#
    		#variable_S_GRAINS#
    		variable 	LX equal lx
    		variable 	LY equal ly
    		variable 	PHI equal "v_S_GRAINS / (v_LX*v_LY)"
    		variable     	S_XX equal c_moy_sigma_comp[1]
    		variable     	S_YY equal c_moy_sigma_comp[2]
    		variable     	S_XY equal c_moy_sigma_comp[4]
    		variable     	P equal "(c_moy_sigma_comp[1]+ c_moy_sigma_comp[2])/2"
    	
	## Stress control test ##

    		fix          	sur_amortissement all viscous ${VISC} # viscous damping
    		fix          	ela_comp all deform 1 x wiggle ${A_COMP} ${TP_COMP} &
                               y wiggle ${A_COMP} ${TP_COMP} &
                               units box remap v
    		fix          	2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction
    		
	## Output command ##
    
    		thermo       	500 # output every 500 step of time
    		thermo_style 	custom step atoms c_temp_ela_comp c_moy_voisin &
                 		v_PHI v_P c_u_moy_comp[1] c_u_moy_comp[2] &
                 		lx ly &
                 		v_S_XX  v_S_YY v_S_XY &
                 		v_P 
    
    		#dump		comp_ela_img all image 20000 comp_ela.*.jpg type type &
    		#             	zoom 1.6 adiam 1.5
    		#dump_modify	comp_ela_img pad 5
    
		#dump         	compression all movie 500 compression.avi type type &
				#zoom 1.6 adiam 1.5 # create a video of the compression
		#dump_modify  	compression pad 5
	
	## End of elastic compression ##

		run	         100000 #  100 000 step of simulation 
    
### End of elastic compression step ###
