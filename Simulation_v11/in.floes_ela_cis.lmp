### Restart simulation ###
### Elastic unixial shearing of granular media ###
    
	## Begining of the simulation ##
	
    		timestep    	1E-4 # simulation time step

	## Computation ## 
	
		# Variable 
   		variable 	CUTOFF equal 1.4
 
    		# Stress of the system  
    		compute      	sigma all stress/atom NULL virial # computation of the stress tensor componenent for each atoms
    		compute      	moy_sigma all reduce sum c_sigma[*] # su m the stress tensor over every atoms
        
    		# Neighbor computation
    		compute      	voisin all coord/atom cutoff ${CUTOFF}# compute number of neighbor  at d = dmin of the center of each grains
    		compute      	moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains
    
    		# Grains movement
    		compute      	u_cis all displace/atom
    		compute      	u_moy_cis all reduce ave c_u_cis[*][*]
    
     		# Temperature
    		compute      	temp_ela_sh all temp/sphere

	## Variable ##

    		variable     	A_CIS equal 4E-1
    		variable    	TP_CIS equal 0.1
    		#variable_VISC#
    		#variable_S_GRAINS#
    		variable 	LX equal lx
    		variable 	LY equal ly
    		variable 	PHI equal "v_S_GRAINS / (v_LX*v_LY)"
    		variable     	P equal "(c_moy_sigma[1]+c_moy_sigma[2])/2"
    		variable     	COMP equal 5000
    		variable     	S_XX equal c_moy_sigma[1]
    		variable     	S_YY equal c_moy_sigma[2]
    		variable     	S_XY equal c_moy_sigma[4]
   
	## Sample shearing ##   
		# Define of the shearing with constant speed imposed by tilting the simulation box + unixial compression
    
    		fix          	sur_amortissement all viscous ${VISC} # viscous damping
    		fix          	cis_ela all deform 1 &
                  		xy wiggle ${A_CIS} ${TP_CIS} &
                  		units box remap v 
    		fix          	comp_floes all nph/sphere & 
                  		y ${COMP} ${COMP} 1 &
          		        couple none disc
    		fix          	2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction
    		
	## Output command ##

    		thermo       	500 # output every 500 step of time
    		thermo_style 	custom & 
                 		step atoms c_temp_ela_sh & 
                 		c_moy_voisin v_PHI &
                 		lx ly cellgamma & 
                 		v_S_XX v_S_YY v_S_XY & 
                 		v_P c_u_moy_cis[1] c_u_moy_cis[2]
    
    		# Graphic output
    		#dump		cis_ela_img all image 20000 cis_ela.*.jpg type type &
    		#             	zoom 1.6 adiam 1.5
    		#dump_modify	cis_ela_img pad 5
    
    		#dump         	evo_voisin all custom 1000 voisin.txt id c_voisin # output the number of neighbor / grain in a text file 
 
    		#dump         	shearing_ela all movie 500 shearing_ela.avi type type &
    		#             	zoom 1.2 adiam 1.5 # create a movie of the shearing
		#dump_modify  	shearing_ela pad 5

	## End of elastic shearing ##
    
		run          	100000 #  100 000 step of simulation 
    
### End of elastic shearing step ###
