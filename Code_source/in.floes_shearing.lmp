### Uniaxial shearing ###
		
		# Add action/reaction between grains
		newton       	on # off = no action/reaction
		neighbor     	0.1 bin # Update frequency of the particle list 
		neigh_modify 	delay 1 # Update frequency of the particle list every 1 step of time
    
    	## Stress, coordination number and grain movement computation ##
 
    		# Neighbor computation
    		compute	voisin all coord/atom cutoff ${CUTOFF} # compute number of neighbor at d = dmin of the center of each grains
    		compute	moy_voisin all reduce ave c_voisin # mean of the neighbor over all the grains
    
    		# Stress of the system
    		compute      	sigma all stress/atom NULL virial # computation of the stress tensor componenent for each atoms
    		compute      	moy_sigma all reduce sum c_sigma[*] # sum the stress tensor over every atoms
    
	## Variable ##
		
		# Contant 
		variable 	PI equal 3.14159265 # constant Pi 
		
		# Simulation parameters 
		variable 	DT equal 1E-4 # discretization time 
		variable 	SH_LEN equal 60 # length of the shearing step in seconds 
		variable 	N_STEP equal "v_SH_LEN / v_DT" # number of step of simulations
		
    		variable     	FILE equal 1000 # restart file every 1000 time steps
    		variable 	V_FILE equal 1E4 # create 7 dump file for velocity at t = 0,10,20,30 ... 60 s 
    		
    		variable     	COMP equal 5000 # unixial compression in Pa
		
		# Stress monitoring variable 
		variable     	S_XX equal c_moy_sigma[1] # normal stress S_xx
    		variable     	S_YY equal c_moy_sigma[2] # normal stress S_yy
    		variable     	S_XY equal c_moy_sigma[4] # shear stress S_xy
    		
    		# Packing fraction monitoring 
    		#variable_S_GRAINS#
    		variable 	LX equal lx
    		variable 	LY equal ly
    		variable 	SIN_A equal "sin((v_PI*cellgamma)/180)" # compute the surface of simulation box
    		variable 	PHI equal "v_S_GRAINS / (v_LX*v_LY*v_SIN_A)" # compute packing fraction
    		variable    	SHEAR equal 2.5E-3 # imposed shear rate
    		variable     	P equal "(c_moy_sigma[1]+c_moy_sigma[2])/2"
    
   		# Elastic properties files #

    		# create a file to restart a simulation every FILE step of times 
    		restart 	${FILE} endo.restart
    		
    	## Add grain/grain friction ##

    		pair_style   	gran/hertz/history ${K_N} ${K_T} ${GAMMA_N} ${GAMMA_T} ${MU} 1 # Frictional hertzian contact with historical effect
		pair_coeff	* * 
    	
    	## Beginning of the simulation ## 

    		timestep	${DT} # simulation time step 

	## Shearing of the sample ##
    
		# Define of the shearing with constant speed imposed by tilting the simulation box + unixial compression
		
    		fix         	over_damp all viscous ${VISC} # viscous damping
    		
    		# Uniaxial shearing of the simulation box     
    		fix         	cisaillement all deform 1 &  
        	         	xy erate ${SHEAR} & 
        	         	units box remap v 
        	         	  
        	# Uniaxial compression of the simulation box 	         	
    		fix         	comp_floes all nph/sphere & 
                		y ${COMP} ${COMP} 1 &
    	             		couple none disc    	
    	             		             		
    		fix         	2Dsimu all enforce2d # ensure 2D simulation by zeroing strenght/speed in z direction

	## Output command ##

		reset_timestep	0
    		thermo       	1000 # output every 1 000 step of time
    		
    		# (0) number of the step ; (1) number of atoms ; (2) mean coordination number ; (3) packing fraction ; (4) horizontal simulation box length 
    		# (5) vertical simulation box length ; (6) angle of inclinaison of the box ; (7) stress S_xx ; (8) stress S_yy ; (9) stress S_xy ; 
    		thermo_style 	custom & 
                 		step atoms c_moy_voisin v_PHI lx &
                	 	ly cellgamma v_S_XX v_S_YY v_S_XY & 

   		# Graphic output
    		dump		cisaillement_img all image 200000 cisaillement.*.jpg type type zoom 1.6
    		dump_modify	cisaillement_img pad 5 adiam 1 ${DMIN} adiam 2 ${DMAX}
    		
    		# create a dump file with the position/speed of the grains every V_FILE iteration 
    		dump 		position all custom ${V_FILE} u_v_file.txt & 
    				id x y vx vy diameter c_voisin
    
    		#dump         	shearing all movie 500 shearing.avi type type &
    		#             	zoom 1.2 adiam 1.5 # create a video of the shearing 
		#dump_modify  	shearing pad 5

	## End of shearing ##
    
		run          	${N_STEP} # step of simulation 
    
### End of shearing step ###
